<script>
(function () {
"use strict";
var DEFAULTS = {
animationDuration: 750,      // Duration for is-playing class (ms)
observerTimeout: 5000,       // Auto-disconnect observers after this time (ms)
scrollPulseInterval: 60,     // Interval between scroll/resize pulses (ms)
scrollPulseCount: 10,        // Number of interval pulses
rafPulseCount: 4             // Number of requestAnimationFrame pulses
};
var externalOptions = (typeof window !== 'undefined' &&
window.CarrdPluginOptions &&
window.CarrdPluginOptions.noLoadwaiting) || {};
var CONFIG = {};
for (var key in DEFAULTS) {
CONFIG[key] = externalOptions.hasOwnProperty(key) ? externalOptions[key] : DEFAULTS[key];
}
var initialized = false;
var cachedBody = null;
function getBody() {
if (cachedBody && cachedBody.isConnected) return cachedBody;
cachedBody = document.body;
return cachedBody;
}
function markReadyNow() {
var body = getBody();
if (!body) return;
body.classList.remove("is-loading", "with-loader");
if (!body.classList.contains("is-ready")) {
body.classList.add("is-ready");
body.classList.add("is-playing");
setTimeout(function () {
body.classList.remove("is-playing");
}, CONFIG.animationDuration);
}
}
function hideLoaderIfPresent() {
var loader = document.getElementById("loader");
if (!loader) return false;
loader.style.cssText = "display:none !important; visibility:hidden !important; opacity:0 !important; pointer-events:none !important;";
return true;
}
function kickScrollHandlers() {
var pulses = 0;
var timer = setInterval(function () {
if (++pulses >= CONFIG.scrollPulseCount) {
clearInterval(timer);
return;
}
dispatchLayoutEvents();
}, CONFIG.scrollPulseInterval);
var rafPulses = 0;
(function rafTick() {
dispatchLayoutEvents();
if (++rafPulses < CONFIG.rafPulseCount) requestAnimationFrame(rafTick);
})();
}
function dispatchLayoutEvents() {
try {
window.dispatchEvent(new Event("resize"));
window.dispatchEvent(new Event("scroll"));
} catch (e) {
/* ignore */
}
}
function setupObservers() {
var body = getBody();
if (!body) return;
var classObserver = new MutationObserver(function () {
if (body.classList.contains("with-loader")) {
body.classList.remove("with-loader");
}
});
var childObserver = new MutationObserver(function () {
if (hideLoaderIfPresent()) {
childObserver.disconnect();
}
});
classObserver.observe(body, {
attributes: true,
attributeFilter: ["class"],
});
childObserver.observe(body, { childList: true });
setTimeout(function () {
classObserver.disconnect();
childObserver.disconnect();
}, CONFIG.observerTimeout);
}
function init() {
if (initialized) return;
initialized = true;
try {
markReadyNow();
hideLoaderIfPresent();
setupObservers();
kickScrollHandlers();
} catch (e) {
console.warn("early-animate-override failed:", e);
}
}
if (document.readyState === "loading") {
document.addEventListener("DOMContentLoaded", init, { once: true });
} else {
init();
}
})();
</script>
