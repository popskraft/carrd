/* Modal v0.1.3 (2026-01-14) */(function(){'use strict';const DEFAULTS={modalSelector:'.container-component.modal',closeOnOverlay:true,closeOnEscape:true,showCloseButton:true,lockBodyScroll:true,preventWhenCartOpen:false};const externalOptions=(typeof window!=='undefined'&&window.CarrdPluginOptions&&window.CarrdPluginOptions.modal)||{};const CONFIG={...DEFAULTS,...externalOptions};const ICONS={close:`<svg viewBox="0 0 24 24"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>`};let activeModal=null;let overlay=null;const modalWrappers=new Map();const cartOpenSelector='.crt-panel.open, .crt-overlay.open';const ModalAPI={open:function(modalId){if(CONFIG.preventWhenCartOpen&&document.querySelector(cartOpenSelector)){return;}const id=modalId.replace(/^#/,'');const modal=modalWrappers.get(id);if(!modal){console.warn(`Modal: No modal found with id "${id}"`);return;}if(activeModal&&activeModal!==id){this.close();}this.lastFocus=document.activeElement;ensureOverlayPlacement(modal);if(overlay){overlay.classList.add('is-open');}modal.classList.add('is-open');modal.setAttribute('aria-hidden','false');requestAnimationFrame(()=>{requestAnimationFrame(()=>{modal.classList.add('is-visible');});});if(CONFIG.lockBodyScroll){document.body.classList.add('modal-open');}activeModal=id;const firstFocusable=modal.querySelector('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');if(firstFocusable){setTimeout(()=>firstFocusable.focus(),50);}else{modal.setAttribute('tabindex','-1');modal.focus();}document.addEventListener('keydown',this.handleTabKey);},handleTabKey:function(e){if(e.key!=='Tab'||!activeModal)return;const modal=modalWrappers.get(activeModal);const focusables=modal.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');if(focusables.length===0){e.preventDefault();return;}const first=focusables[0];const last=focusables[focusables.length-1];if(e.shiftKey){if(document.activeElement===first){e.preventDefault();last.focus();}}else{if(document.activeElement===last){e.preventDefault();first.focus();}}},close:function(){if(!activeModal)return;const modal=modalWrappers.get(activeModal);document.removeEventListener('keydown',this.handleTabKey);if(overlay){overlay.classList.remove('is-open');}if(modal){modal.classList.remove('is-visible');modal.classList.remove('is-open');modal.setAttribute('aria-hidden','true');}if(CONFIG.lockBodyScroll){document.body.classList.remove('modal-open');}activeModal=null;if(this.lastFocus&&typeof this.lastFocus.focus==='function'){this.lastFocus.focus();this.lastFocus=null;}},toggle:function(modalId){const id=modalId.replace(/^#/,'');if(activeModal===id){this.close();}else{this.open(id);}},isOpen:function(modalId){if(modalId){return activeModal===modalId.replace(/^#/,'');}return activeModal!==null;}};window.ModalPlugin=ModalAPI;window.CarrdModal=ModalAPI;function createOverlay(){overlay=document.createElement('div');overlay.className='modal-overlay';overlay.setAttribute('aria-hidden','true');if(CONFIG.closeOnOverlay){overlay.addEventListener('click',()=>ModalAPI.close());}document.body.appendChild(overlay);}function ensureOverlayPlacement(modal){if(!overlay||!modal||!modal.parentNode)return;const parent=modal.parentNode;if(overlay.parentNode!==parent||overlay.nextSibling!==modal){parent.insertBefore(overlay,modal);}}function setupModal(modal){const modalId=modal.id;if(!modalId){console.warn('Modal: Modal element must have an ID',modal);return null;}if(CONFIG.showCloseButton){if(!modal.querySelector('.modal-close')){const closeBtn=document.createElement('button');closeBtn.className='modal-close';closeBtn.setAttribute('aria-label','Close modal');closeBtn.innerHTML=ICONS.close;closeBtn.addEventListener('click',(e)=>{e.stopPropagation();ModalAPI.close();});const inner=modal.querySelector('.inner');if(inner){inner.insertBefore(closeBtn,inner.firstChild);}else{modal.insertBefore(closeBtn,modal.firstChild);}}}modal.setAttribute('role','dialog');modal.setAttribute('aria-modal','true');modal.setAttribute('aria-hidden','true');modalWrappers.set(modalId,modal);modal.dataset.modalInitialized='true';return modal;}function bindTriggers(){document.addEventListener('click',(e)=>{const trigger=e.target.closest('a[href^="#"], button[data-modal]');if(!trigger)return;let modalId=null;if(trigger.hasAttribute('href')){const href=trigger.getAttribute('href');if(href&&href.startsWith('#')&&href.length>1){const targetId=href.substring(1);if(modalWrappers.has(targetId)){modalId=targetId;}}}if(!modalId&&trigger.hasAttribute('data-modal')){modalId=trigger.getAttribute('data-modal').replace(/^#/,'');}if(modalId){e.preventDefault();ModalAPI.open(modalId);}});}function bindKeyboard(){if(CONFIG.closeOnEscape){document.addEventListener('keydown',(e)=>{if(e.key==='Escape'&&activeModal){ModalAPI.close();}});}}function init(){const modals=document.querySelectorAll(CONFIG.modalSelector);if(!modals.length)return;createOverlay();modals.forEach(modal=>{if(modal.dataset.modalInitialized==='true')return;setupModal(modal);});bindTriggers();bindKeyboard();}if(document.readyState==='loading'){document.addEventListener('DOMContentLoaded',init);}else{init();}})();