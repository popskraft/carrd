<style>
.container-component.modal{display:none !important}.container-component.modal.is-open{display:flex !important;position:fixed;inset:0;z-index:1000001;align-items:center;justify-content:center;padding:var(--mini-modal-padding, 1rem);pointer-events:none;margin:0 !important;width:100% !important;max-width:100% !important;height:100% !important;background:transparent !important}.modal-overlay{position:fixed;inset:0;background:var(--mini-modal-overlay-bg, var(--mini-overlay-bg, rgba(218, 225, 228, 0.792)));backdrop-filter:blur(0);-webkit-backdrop-filter:blur(0);z-index:1000000;opacity:0;visibility:hidden;pointer-events:auto;transition:opacity 0.3s ease, visibility 0.3s ease, backdrop-filter 0.3s ease;will-change:opacity, backdrop-filter}.modal-overlay.is-open{opacity:1;visibility:visible;backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px)}.container-component.modal>.wrapper{pointer-events:auto;position:relative;width:100%;max-width:var(--mini-modal-max-width, 600px);max-height:var(--mini-modal-max-height, 90vh);overflow-y:auto;transform:translateY(-60px);opacity:0;transition:transform 0.5s ease, opacity 0.5s ease;will-change:transform, opacity}.container-component.modal.is-visible>.wrapper{transform:translateY(0);opacity:1}.modal-close{position:absolute;top:var(--mini-modal-close-top, 1rem);right:var(--mini-modal-close-right, 1rem);z-index:10;width:var(--mini-modal-close-size, 32px);height:var(--mini-modal-close-size, 32px);padding:0;border:none;border-radius:50%;background:var(--mini-modal-close-bg, rgba(0, 0, 0, 0.1));color:var(--mini-modal-close-color, currentColor);cursor:pointer;display:flex;align-items:center;justify-content:center;transition:background 0.2s ease, transform 0.2s ease}.modal-close:hover{background:var(--mini-modal-close-hover-bg, rgba(0, 0, 0, 0.2));transform:scale(1.1)}.modal-close:focus{outline:2px solid var(--mini-color-primary, #5c9dff);outline-offset:2px}.modal-close svg{width:16px;height:16px;stroke:currentColor;stroke-width:2;fill:none}body.modal-open{overflow:hidden}@media (max-width:736px){.container-component.modal.is-open{padding:var(--mini-modal-padding-mobile, 0.5rem);align-items:flex-end}.container-component.modal>.wrapper{max-height:var(--mini-modal-max-height-mobile, 85vh);border-radius:var(--mini-modal-border-radius-mobile, 1rem 1rem 0 0)}.container-component.modal:not(.is-visible)>.wrapper{transform:translateY(100%)}}@media (prefers-reduced-motion:reduce){.modal-overlay, .container-component.modal>.wrapper{transition:none}}
</style>
<script>
/**
* Modal Plugin
* Opens modal containers when clicking elements with href="#modalId"
*
* Targets: .container-component.modal with specific ID (e.g., #modalContact)
*
* Features:
* - Click to open via href="#modalId"
* - Close on overlay click
* - Close on Escape key
* - Close button
* - Body scroll lock
* - Smooth animations
*/
(function() {
'use strict';
const DEFAULTS = {
modalSelector: '.container-component.modal',
closeOnOverlay: true,
closeOnEscape: true,
showCloseButton: true,
lockBodyScroll: true,
preventWhenCartOpen: false
};
const externalOptions = (typeof window !== 'undefined' &&
window.CarrdPluginOptions &&
window.CarrdPluginOptions.modal) || {};
const CONFIG = { ...DEFAULTS, ...externalOptions };
const ICONS = {
close: `<svg viewBox="0 0 24 24"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>`
};
let activeModal = null;
let overlay = null;
const modalWrappers = new Map();
const cartOpenSelector = '.crt-panel.open, .crt-overlay.open';
const ModalAPI = {
/**
* Open a modal by ID
* @param {string} modalId - The ID of the modal to open (without #)
*/
/**
* Open a modal by ID
* @param {string} modalId - The ID of the modal to open (without #)
*/
open: function(modalId) {
if (CONFIG.preventWhenCartOpen && document.querySelector(cartOpenSelector)) {
return;
}
const id = modalId.replace(/^#/, '');
const modal = modalWrappers.get(id);
if (!modal) {
console.warn(`Modal: No modal found with id "${id}"`);
return;
}
if (activeModal && activeModal !== id) {
this.close();
}
ensureOverlayPlacement(modal);
if (overlay) {
overlay.classList.add('is-open');
}
modal.classList.add('is-open');
requestAnimationFrame(() => {
modal.classList.add('is-visible');
});
if (CONFIG.lockBodyScroll) {
document.body.classList.add('modal-open');
}
activeModal = id;
const firstFocusable = modal.querySelector('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');
if (firstFocusable) {
setTimeout(() => firstFocusable.focus(), 100);
}
},
/**
* Close the currently open modal
*/
close: function() {
if (!activeModal) return;
const modal = modalWrappers.get(activeModal);
if (overlay) {
overlay.classList.remove('is-open');
}
if (modal) {
modal.classList.remove('is-visible');
modal.classList.remove('is-open');
}
if (CONFIG.lockBodyScroll) {
document.body.classList.remove('modal-open');
}
activeModal = null;
},
/**
* Toggle a modal
* @param {string} modalId - The ID of the modal to toggle
*/
toggle: function(modalId) {
const id = modalId.replace(/^#/, '');
if (activeModal === id) {
this.close();
} else {
this.open(id);
}
},
/**
* Check if a modal is open
* @param {string} modalId - Optional modal ID to check
* @returns {boolean}
*/
isOpen: function(modalId) {
if (modalId) {
return activeModal === modalId.replace(/^#/, '');
}
return activeModal !== null;
}
};
window.ModalPlugin = ModalAPI;
window.CarrdModal = ModalAPI; // Alias
/**
* Create the shared overlay element
*/
function createOverlay() {
overlay = document.createElement('div');
overlay.className = 'modal-overlay';
overlay.setAttribute('aria-hidden', 'true');
if (CONFIG.closeOnOverlay) {
overlay.addEventListener('click', () => ModalAPI.close());
}
document.body.appendChild(overlay);
}
/**
* Ensure overlay shares the same stacking context as the active modal.
* @param {HTMLElement} modal - The modal element
*/
function ensureOverlayPlacement(modal) {
if (!overlay || !modal || !modal.parentNode) return;
const parent = modal.parentNode;
if (overlay.parentNode !== parent || overlay.nextSibling !== modal) {
parent.insertBefore(overlay, modal);
}
}
/**
* Setup a modal element
* @param {HTMLElement} modal - The modal element
*/
function setupModal(modal) {
const modalId = modal.id;
if (!modalId) {
console.warn('Modal: Modal element must have an ID', modal);
return null;
}
if (CONFIG.showCloseButton) {
if (!modal.querySelector('.modal-close')) {
const closeBtn = document.createElement('button');
closeBtn.className = 'modal-close';
closeBtn.setAttribute('aria-label', 'Close modal');
closeBtn.innerHTML = ICONS.close;
closeBtn.addEventListener('click', (e) => {
e.stopPropagation(); // Prevent bubbling
ModalAPI.close();
});
const inner = modal.querySelector('.inner');
if (inner) {
inner.insertBefore(closeBtn, inner.firstChild);
} else {
modal.insertBefore(closeBtn, modal.firstChild);
}
}
}
modalWrappers.set(modalId, modal);
modal.dataset.modalInitialized = 'true';
return modal;
}
/**
* Bind click handlers for modal triggers
*/
function bindTriggers() {
document.addEventListener('click', (e) => {
const trigger = e.target.closest('a[href^="#"], button[data-modal]');
if (!trigger) return;
let modalId = null;
if (trigger.hasAttribute('href')) {
const href = trigger.getAttribute('href');
if (href && href.startsWith('#') && href.length > 1) {
const targetId = href.substring(1);
if (modalWrappers.has(targetId)) {
modalId = targetId;
}
}
}
if (!modalId && trigger.hasAttribute('data-modal')) {
modalId = trigger.getAttribute('data-modal').replace(/^#/, '');
}
if (modalId) {
e.preventDefault();
ModalAPI.open(modalId);
}
});
}
/**
* Bind keyboard handlers
*/
function bindKeyboard() {
if (CONFIG.closeOnEscape) {
document.addEventListener('keydown', (e) => {
if (e.key === 'Escape' && activeModal) {
ModalAPI.close();
}
});
}
}
function init() {
const modals = document.querySelectorAll(CONFIG.modalSelector);
if (!modals.length) return;
createOverlay();
modals.forEach(modal => {
if (modal.dataset.modalInitialized === 'true') return;
setupModal(modal);
});
bindTriggers();
bindKeyboard();
}
if (document.readyState === 'loading') {
document.addEventListener('DOMContentLoaded', init);
} else {
init();
}
})();
</script>
