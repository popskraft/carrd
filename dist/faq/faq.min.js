(function () {
'use strict';
const CONTAINER_SELECTOR = '.FAQContainer';
const DIVIDER_SELECTOR = 'hr.divider-component';
const HEADER_TAGS = new Set(['H1', 'H2', 'H3']);
let answerIdCounter = 0;
const containers = document.querySelectorAll(CONTAINER_SELECTOR);
if (!containers.length) return;
const openAnswers = new Set();
const requestFrame = window.requestAnimationFrame || (cb => setTimeout(cb, 16));
let resizeHandle = null;
const scheduleOpenAnswerSync = () => {
if (resizeHandle !== null) return;
resizeHandle = requestFrame(() => {
openAnswers.forEach(answer => adjustHeight(answer));
resizeHandle = null;
});
};
const answerResizeObserver =
typeof ResizeObserver !== 'undefined'
? new ResizeObserver(entries => {
entries.forEach(entry => {
if (openAnswers.has(entry.target)) {
adjustHeight(entry.target);
}
});
})
: null;
containers.forEach(container => {
const dividers = Array.from(container.querySelectorAll(DIVIDER_SELECTOR)).filter(
divider => divider.closest(CONTAINER_SELECTOR) === container
);
if (!dividers.length) return;
dividers.forEach(startDivider => {
const endDivider = findNextDivider(startDivider);
const header = findHeaderBetween(startDivider, endDivider);
if (!header || header.dataset.faqBound === 'true') {
return;
}
const answerWrapper =
header.nextElementSibling && header.nextElementSibling.classList.contains('faq-answer')
? header.nextElementSibling
: wrapAnswerContent(header, endDivider);
if (!answerWrapper) {
return;
}
prepareToggle(header, answerWrapper);
});
});
window.addEventListener('resize', scheduleOpenAnswerSync);
window.addEventListener('orientationchange', scheduleOpenAnswerSync);
function findNextDivider(divider) {
let node = divider.nextElementSibling;
while (node) {
if (isDivider(node)) {
return node;
}
node = node.nextElementSibling;
}
return null;
}
function findHeaderBetween(startDivider, endDivider) {
let node = startDivider.nextElementSibling;
let firstParagraph = null;
while (node && node !== endDivider) {
if (isHeader(node)) {
return node;
}
if (!firstParagraph && node.nodeType === 1 && node.tagName === 'P') {
firstParagraph = node;
}
node = node.nextElementSibling;
}
if (!endDivider) {
while (node) {
if (isHeader(node)) {
return node;
}
if (!firstParagraph && node.nodeType === 1 && node.tagName === 'P') {
firstParagraph = node;
}
node = node.nextElementSibling;
}
}
return firstParagraph;
}
function wrapAnswerContent(header, endDivider) {
let node = header.nextSibling;
const wrapper = document.createElement('div');
wrapper.className = 'faq-answer';
let hasContent = false;
while (node && node !== endDivider) {
const next = node.nextSibling;
wrapper.appendChild(node);
hasContent = true;
node = next;
}
if (!hasContent) {
return null;
}
if (endDivider && endDivider.parentNode) {
header.parentNode.insertBefore(wrapper, endDivider);
} else {
header.parentNode.appendChild(wrapper);
}
return wrapper;
}
function prepareToggle(header, answer) {
header.classList.add('faq-question');
header.dataset.faqBound = 'true';
header.classList.add('is-closed');
if (!header.hasAttribute('tabindex')) {
header.setAttribute('tabindex', '0');
}
header.setAttribute('role', 'button');
header.setAttribute('aria-expanded', 'false');
if (!answer.id) {
answerIdCounter += 1;
answer.id = `faq-answer-${answerIdCounter}`;
}
answer.setAttribute('aria-hidden', 'true');
answer.classList.add('is-closed');
header.setAttribute('aria-controls', answer.id);
if (answerResizeObserver) {
answerResizeObserver.observe(answer);
}
const toggle = () => toggleAnswer(header, answer);
header.addEventListener('click', toggle);
header.addEventListener('keydown', event => {
if (event.key === 'Enter' || event.key === ' ') {
event.preventDefault();
toggle();
}
});
}
function toggleAnswer(header, answer) {
const willOpen = !header.classList.contains('is-open');
header.classList.toggle('is-open', willOpen);
header.classList.toggle('is-closed', !willOpen);
answer.classList.toggle('is-open', willOpen);
answer.classList.toggle('is-closed', !willOpen);
header.setAttribute('aria-expanded', String(willOpen));
answer.setAttribute('aria-hidden', String(!willOpen));
if (willOpen) {
openAnswers.add(answer);
adjustHeight(answer);
scheduleOpenAnswerSync();
} else {
openAnswers.delete(answer);
answer.style.maxHeight = '0px';
}
}
function adjustHeight(answer) {
answer.style.maxHeight = `${answer.scrollHeight}px`;
}
function isHeader(node) {
return node && node.nodeType === 1 && HEADER_TAGS.has(node.tagName);
}
function isDivider(node) {
return (
node &&
node.nodeType === 1 &&
node.tagName === 'HR' &&
node.classList.contains('divider-component')
);
}
})();