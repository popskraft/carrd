/* Shopping Cart v0.1.11 (2026-02-17) */(function(){'use strict';const DEFAULTS={currency:'$',currencyPosition:'before',position:'top-right',storageKey:'carrd_cart_v1',orderInputSelector:'[name="order-details"], #order-details',orderInputClass:'.cart-output',texts:{title:'Shopping Cart',empty:'Your cart is empty.',checkout:'Checkout',total:'Total',remove:'Remove',required:'Required',addedToCart:'Added "${name}" to cart',errorName:'Invalid product name',errorPrice:'Invalid price for ${name}',errorForm:'Error: Could not find the order form. Please contact support.',consoleErrorForm:'Carrd Cart: Could not find "Order Details" field. Please ensure a Textarea with name="order-details" or ID="order-details" exists.'}};const SELECTORS={containerId:'theme-shopcart-container',widget:'theme-shopcart-widget',badge:'theme-shopcart-badge',overlay:'theme-shopcart-overlay',panel:'theme-shopcart-panel',header:'theme-shopcart-header',title:'theme-shopcart-title',close:'theme-shopcart-close',body:'theme-shopcart-body',footer:'theme-shopcart-footer',item:'theme-shopcart-item',itemInfo:'theme-shopcart-item-info',itemName:'theme-shopcart-item-name',itemPrice:'theme-shopcart-item-price',controls:'theme-shopcart-controls',btnQty:'theme-shopcart-btn-qty',btnRemove:'theme-shopcart-btn-remove',btnMain:'theme-shopcart-btn-main',btnCheckout:'theme-shopcart-btn-checkout',totalRow:'theme-shopcart-total-row',totalAmount:'theme-shopcart-total-amount',toast:'theme-shopcart-toast',emptyState:'theme-shopcart-empty-state',posBr:'theme-shopcart-pos-br',posTr:'theme-shopcart-pos-tr',posBl:'theme-shopcart-pos-bl',posBc:'theme-shopcart-pos-bc',stateVisible:'visible',stateOpen:'open'};function deepMerge(target,source){if(!source||typeof source!=='object')return target;const result={...target};for(const key in source){if(Object.prototype.hasOwnProperty.call(source,key)){if(source[key]&&typeof source[key]==='object'&&!Array.isArray(source[key])){result[key]=deepMerge(target[key]||{},source[key]);}else{result[key]=source[key];}}}return result;}const externalOptions=(typeof window!=='undefined'&&window.CarrdPluginOptions&&window.CarrdPluginOptions.shoppingCart)||{};const CONFIG=deepMerge(DEFAULTS,externalOptions);function escapeHtml(str){if(typeof str!=='string')return'';const div=document.createElement('div');div.textContent=str;return div.innerHTML;}function validateCartItem(item){if(!item||typeof item!=='object')return false;if(typeof item.name!=='string'||item.name.length===0||item.name.length>200)return false;if(typeof item.price!=='number'||isNaN(item.price)||item.price<0)return false;if(typeof item.qty!=='number'||!Number.isInteger(item.qty)||item.qty<1)return false;return true;}let state={cart:[],isOpen:false};try{const stored=localStorage.getItem(CONFIG.storageKey);if(stored){const parsed=JSON.parse(stored);if(Array.isArray(parsed)){state.cart=parsed.filter(validateCartItem);}}}catch(e){console.warn('LocalStorage not available or corrupted');state.cart=[];}const saveState=()=>{try{localStorage.setItem(CONFIG.storageKey,JSON.stringify(state.cart));}catch(e){}updateUI();};const CartAPI={add:function(name,price){if(typeof name!=='string'||name.trim().length===0){console.error(CONFIG.texts.errorName);return;}name=name.trim();if(name.length>200){console.error('Product name too long (max 200 chars)');return;}price=parseFloat(price);if(isNaN(price)||price<0){console.error(CONFIG.texts.errorPrice.replace('${name}',name));return;}const existing=state.cart.find(item=>item.name===name);if(existing){existing.qty++;}else{state.cart.push({name,price,qty:1});}saveState();showToast(CONFIG.texts.addedToCart.replace('${name}',name));if(state.cart.length===1&&state.cart[0].qty===1){this.open();}},remove:function(name){state.cart=state.cart.filter(item=>item.name!==name);saveState();},updateQty:function(name,delta){const item=state.cart.find(i=>i.name===name);if(!item)return;item.qty+=delta;if(item.qty<=0){this.remove(name);}else{saveState();}},clear:function(){state.cart=[];saveState();},getCart:function(){return[...state.cart];},getTotal:function(){return state.cart.reduce((sum,item)=>sum+(item.price*item.qty),0);},open:function(){state.isOpen=true;updateUI();},close:function(){state.isOpen=false;updateUI();},checkout:function(){if(state.cart.length===0)return;const total=this.getTotal();const summary=['--- ORDER DETAILS ---',...state.cart.map(item=>`${item.qty} x ${item.name}: ${formatPrice(item.price * item.qty)}`),'---------------------',`TOTAL: ${formatPrice(total)}`].join('\n');let orderField=document.querySelector(CONFIG.orderInputSelector)||document.querySelector(CONFIG.orderInputClass)||document.querySelector('[name="order-details"]')||document.querySelector('#order-details');if(!orderField){const candidates=document.querySelectorAll('textarea');for(const el of candidates){const id=(el.id||'').toLowerCase();const name=(el.name||'').toLowerCase();if(id.includes('order')||name.includes('order')||id.includes('cart')||name.includes('cart')){orderField=el;console.log('Carrd Cart: Found order field via fuzzy search:',el);break;}}}if(!orderField){console.error(CONFIG.texts.consoleErrorForm);alert(CONFIG.texts.errorForm);return;}orderField.value=summary;this.close();window.location.href='#shopping-cart';},configure:function(options){if(!options||typeof options!=='object')return;const merged=deepMerge(CONFIG,options);Object.assign(CONFIG,merged);updateUI();},getConfig:function(){return JSON.parse(JSON.stringify(CONFIG));}};window.CarrdShoppingCart=CartAPI;const ICONS={cart:`<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="9" cy="21" r="1"></circle><circle cx="20" cy="21" r="1"></circle><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path></svg>`,close:`<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>`,trash:`<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>`,plus:`<svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>`,minus:`<svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="5" y1="12" x2="19" y2="12"></line></svg>`};function formatPrice(amount){const fixed=amount.toFixed(2);return CONFIG.currencyPosition==='before'?`${CONFIG.currency}${fixed}`:`${fixed}${CONFIG.currency}`;}function renderCartItems(){if(state.cart.length===0){return`<div class="${SELECTORS.emptyState}">${escapeHtml(CONFIG.texts.empty)}</div>`;}return state.cart.map(item=>{const safeName=escapeHtml(item.name);return`
      <div class="${SELECTORS.item}">
        <div class="${SELECTORS.itemInfo}">
          <span class="${SELECTORS.itemName}">${safeName}</span>
          <span class="${SELECTORS.itemPrice}">${formatPrice(item.price)}</span>
        </div>
        <div class="${SELECTORS.controls}">
          <button class="${SELECTORS.btnQty}" data-action="update-qty" data-name="${safeName}" data-qty="-1" aria-label="Decrease quantity for ${safeName}">${ICONS.minus}</button>
          <span>${item.qty}</span>
          <button class="${SELECTORS.btnQty}" data-action="update-qty" data-name="${safeName}" data-qty="1" aria-label="Increase quantity for ${safeName}">${ICONS.plus}</button>
          <button class="${SELECTORS.btnQty} ${SELECTORS.btnRemove}" data-action="remove" data-name="${safeName}" aria-label="Remove ${safeName} from cart">${ICONS.trash}</button>
        </div>
      </div>
    `;}).join('');}function updateUI(){const container=document.getElementById(SELECTORS.containerId);if(!container)return;const widget=container.querySelector(`.${SELECTORS.widget}`);const badge=container.querySelector(`.${SELECTORS.badge}`);const totalQty=state.cart.reduce((s,i)=>s+i.qty,0);if(state.cart.length>0){widget.classList.add(SELECTORS.stateVisible);}else{widget.classList.remove(SELECTORS.stateVisible);}if(badge){badge.textContent=totalQty;badge.style.display=totalQty>0?'block':'none';}const overlay=container.querySelector(`.${SELECTORS.overlay}`);const panel=container.querySelector(`.${SELECTORS.panel}`);if(state.isOpen){overlay.classList.add(SELECTORS.stateOpen);panel.classList.add(SELECTORS.stateOpen);}else{overlay.classList.remove(SELECTORS.stateOpen);panel.classList.remove(SELECTORS.stateOpen);}const bodyContent=container.querySelector(`.${SELECTORS.body}`);const footerContent=container.querySelector(`.${SELECTORS.footer}`);const titleContent=container.querySelector(`.${SELECTORS.title}`);titleContent.textContent=CONFIG.texts.title;bodyContent.innerHTML=renderCartItems();footerContent.style.display='block';container.querySelector(`.${SELECTORS.totalAmount}`).textContent=formatPrice(CartAPI.getTotal());const checkoutBtn=container.querySelector(`.${SELECTORS.btnCheckout}`);if(checkoutBtn){checkoutBtn.disabled=state.cart.length===0;}}function createWidget(){const div=document.createElement('div');div.id=SELECTORS.containerId;const posMap={'bottom-right':SELECTORS.posBr,'top-right':SELECTORS.posTr,'bottom-left':SELECTORS.posBl,'bottom-center':SELECTORS.posBc};const posClass=posMap[CONFIG.position]||SELECTORS.posBr;div.innerHTML=`
      <div class="${SELECTORS.widget} ${posClass}" data-action="open" role="button" aria-label="Open Shopping Cart" tabindex="0">
        ${ICONS.cart}
        <div class="${SELECTORS.badge}">0</div>
      </div>
      <div class="${SELECTORS.overlay}" data-action="close"></div>
      <div class="${SELECTORS.panel}">
        <div class="${SELECTORS.header}">
          <div class="${SELECTORS.title}">${CONFIG.texts.title}</div>
          <button class="${SELECTORS.close}" data-action="close" aria-label="Close Cart">${ICONS.close}</button>
        </div>
        <div class="${SELECTORS.body}"></div>
        <div class="${SELECTORS.footer}">
          <div class="${SELECTORS.totalRow}">
            <span>${CONFIG.texts.total}</span>
            <span class="${SELECTORS.totalAmount}">$0.00</span>
          </div>
          <button class="${SELECTORS.btnMain} ${SELECTORS.btnCheckout}" data-action="checkout">${CONFIG.texts.checkout}</button>
        </div>
      </div>
      <div class="${SELECTORS.toast}"></div>
    `;document.body.appendChild(div);div.addEventListener('click',(e)=>{const trigger=e.target.closest('[data-action]');if(!trigger)return;const action=trigger.dataset.action;const name=trigger.dataset.name;if(trigger.tagName==='BUTTON')e.preventDefault();switch(action){case'open':CartAPI.open();break;case'close':CartAPI.close();break;case'checkout':CartAPI.checkout();break;case'update-qty':{const delta=parseInt(trigger.dataset.qty);if(name&&!isNaN(delta))CartAPI.updateQty(name,delta);break;}case'remove':if(name)CartAPI.remove(name);break;}});div.addEventListener('keydown',(e)=>{if(e.key==='Enter'||e.key===' '){const trigger=e.target.closest('[data-action="open"]');if(trigger){e.preventDefault();CartAPI.open();}}});}function showToast(msg){const toast=document.querySelector(`.${SELECTORS.toast}`);if(!toast)return;toast.textContent=msg;toast.classList.add(SELECTORS.stateVisible);setTimeout(()=>toast.classList.remove(SELECTORS.stateVisible),3000);}function init(){if(document.getElementById(SELECTORS.containerId))return;createWidget();updateUI();}if(document.readyState==='loading'){document.addEventListener('DOMContentLoaded',init);}else{init();}})();