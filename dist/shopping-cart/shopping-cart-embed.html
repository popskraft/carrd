<style>
.crt-widget{position:fixed;z-index:999990;background:var(--mini-shopcart-icon-bg, var(--mini-color-primary, #3b82f6));color:var(--mini-shopcart-icon-text, var(--mini-color-white, #ffffff));width:60px;height:60px;border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;box-shadow:0 4px 12px rgba(0, 0, 0, 0.3);transition:transform 0.2s, opacity 0.3s, visibility 0.3s;opacity:0;visibility:hidden;transform:scale(0.8);pointer-events:none}.crt-widget.visible{opacity:1;visibility:visible;transform:scale(1);pointer-events:auto}.crt-widget:hover{transform:scale(1.05)}.crt-pos-br{bottom:12vh;right:1rem}.crt-pos-bl{bottom:12vh;left:1rem;right:auto}.crt-pos-tr{top:12vh;right:1rem;bottom:auto}.crt-pos-bc{bottom:1rem;left:50%;right:auto;margin-left:-30px}.crt-widget>svg{margin-left:-4px}.crt-badge{position:absolute;top:-5px;right:-5px;background:var(--mini-shopcart-badge-bg, var(--mini-color-danger, #ef4444));color:var(--mini-shopcart-badge-text, var(--mini-color-white, #ffffff));border-radius:10px;padding:2px 6px;font-size:12px;font-weight:bold;border:2px solid var(--mini-shopcart-badge-border, var(--mini-color-white, #ffffff));font-family:-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif}.crt-overlay{position:fixed;inset:0;background:var(--mini-shopcart-overlay-bg, var(--mini-overlay-bg, rgba(218, 225, 228, 0.792)));z-index:999998;opacity:0;pointer-events:none;backdrop-filter:blur(20px);transition:opacity 0.3s}.crt-overlay.open{opacity:1;pointer-events:auto}.crt-panel{position:fixed;top:0;right:0;bottom:0;width:100%;max-width:500px;background:var(--mini-shopcart-bg, var(--mini-bg, #ffffff));color:var(--mini-shopcart-text, var(--mini-text, #333333));z-index:999999;transform:translateX(110%);transition:transform 0.3s ease-in-out;box-shadow:-4px 0 15px rgba(11, 41, 68, 0.3);display:flex;flex-direction:column;font-family:var(--mini-shopcart-font, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif)}.crt-panel.open{transform:translateX(0)}.crt-header{padding:20px;border-bottom:1px solid var(--mini-shopcart-border, var(--mini-border, #eeeeee));display:flex;justify-content:space-between;align-items:center}.crt-header h2{margin:0;font-size:1.25rem}.crt-close{background:none;border:none;color:inherit;cursor:pointer;padding:5px}.crt-body{overflow-y:auto;padding:20px}.crt-item{display:flex;justify-content:space-between;align-items:center;padding:15px 0;border-bottom:1px solid var(--mini-shopcart-border, var(--mini-border, #eeeeee))}.crt-item-info{flex:1}.crt-item-name{font-weight:600;display:block;margin-bottom:4px}.crt-item-price{opacity:0.8;font-size:0.9em}.crt-controls{display:flex;align-items:center;gap:10px}.crt-btn-qty{background:var(--mini-shopcart-qty-bg, var(--mini-bg-shade, rgba(255, 255, 255, 0.1)));border:none;color:inherit;width:24px;height:24px;border-radius:4px;cursor:pointer;display:flex;align-items:center;justify-content:center}.crt-btn-qty:hover{background:var(--mini-shopcart-qty-hover-bg, var(--mini-bg-shade-hover, rgba(255, 255, 255, 0.2)))}.crt-btn-remove{color:var(--mini-shopcart-danger, var(--mini-color-danger, #ef4444))}.crt-footer{padding:20px;border-top:1px solid var(--mini-shopcart-border, var(--mini-border, #eeeeee));background:var(--mini-shopcart-footer-bg, var(--mini-bg-alt, #6470851a))}.crt-total-row{display:flex;justify-content:space-between;font-size:1.2em;font-weight:bold;margin-bottom:20px}.crt-btn-main{width:100%;padding:12px;background:var(--mini-shopcart-btn-bg, var(--mini-color-primary, #3b82f6));color:var(--mini-shopcart-btn-text, var(--mini-color-white, #ffffff));border:none;border-radius:6px;font-size:1rem;font-weight:600;cursor:pointer;transition:opacity 0.2s}.crt-btn-main:hover{opacity:0.9}.crt-btn-main:disabled{opacity:0.5;cursor:not-allowed}.crt-form-group{margin-bottom:15px}.crt-form-group label{display:block;margin-bottom:5px;font-size:0.9em;opacity:0.9}.crt-input{width:100%;padding:10px;background:var(--mini-shopcart-input-bg, rgba(255, 255, 255, 0.05));border:1px solid var(--mini-shopcart-border, var(--mini-border, #eeeeee));color:var(--mini-shopcart-input-text, var(--mini-text, #ffffff));border-radius:4px;box-sizing:border-box}.crt-input:focus{outline:2px solid var(--mini-shopcart-accent, var(--mini-color-primary, #3b82f6));border-color:transparent}.crt-toast{position:fixed;bottom:90px;right:20px;background:var(--mini-shopcart-toast-bg, var(--mini-bg-inverse, #333333));color:var(--mini-shopcart-toast-text, var(--mini-text-inverse, #ffffff));padding:12px 20px;border-radius:8px;box-shadow:0 4px 12px rgba(0, 0, 0, 0.2);z-index:999999;transform:translateY(20px);opacity:0;transition:0.3s;pointer-events:none;font-family:var(--mini-shopcart-font, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif)}.crt-toast.visible{transform:translateY(0);opacity:1}@media (max-width:480px){.crt-panel{width:100%;max-width:100%}}
</style>
<script>
/**
* Carrd Shopping Cart Plugin - JS Logic
*
* INSTRUCTIONS:
* 1. JS: Copy this code (keeping the <script> tags) into a "Settings > Head" or "Embed" element.
* 2. CSS: Copy the code from 'carrd-cart.css' into a separate "Embed" element (Type: Code, Style: Hidden Head).
* 3. USAGE: Link a button to "On Click" -> CartPlugin.add('Item', 99)
*/
(function() {
'use strict';
const CONFIG = {
currency: '$',
currencyPosition: 'before', // 'before' ($10) or 'after' (10$)
position: 'top-right', // 'bottom-right', 'top-right', 'bottom-left', 'bottom-center'
storageKey: 'carrd_cart_v1',
orderInputSelector: '#form-shopping-cart-order-details', // Default ID
orderInputClass: '.cart-output', // Alternative class for flexibility
texts: {
title: 'Shopping Cart',
empty: 'Your cart is empty.',
checkout: 'Checkout',
total: 'Total',
remove: 'Remove',
required: 'Required',
}
};
/**
* Escapes HTML special characters to prevent XSS attacks
* @param {string} str - Input string
* @returns {string} - Escaped string safe for HTML insertion
*/
function escapeHtml(str) {
if (typeof str !== 'string') return '';
const div = document.createElement('div');
div.textContent = str;
return div.innerHTML;
}
/**
* Escapes a string for use in JavaScript string literals (onclick handlers)
* @param {string} str - Input string
* @returns {string} - Escaped string safe for JS string context
*/
function escapeJsString(str) {
if (typeof str !== 'string') return '';
return str
.replace(/\\/g, '\\\\')
.replace(/'/g, "\\'")
.replace(/"/g, '\\"')
.replace(/</g, '\\x3c')
.replace(/>/g, '\\x3e');
}
/**
* Validates a cart item from localStorage
* @param {Object} item - Cart item to validate
* @returns {boolean} - True if valid
*/
function validateCartItem(item) {
if (!item || typeof item !== 'object') return false;
if (typeof item.name !== 'string' || item.name.length === 0 || item.name.length > 200) return false;
if (typeof item.price !== 'number' || isNaN(item.price) || item.price < 0) return false;
if (typeof item.qty !== 'number' || !Number.isInteger(item.qty) || item.qty < 1) return false;
return true;
}
let state = {
cart: [],
isOpen: false
};
try {
const stored = localStorage.getItem(CONFIG.storageKey);
if (stored) {
const parsed = JSON.parse(stored);
if (Array.isArray(parsed)) {
state.cart = parsed.filter(validateCartItem);
}
}
} catch (e) {
console.warn('LocalStorage not available or corrupted');
state.cart = [];
}
const saveState = () => {
try {
localStorage.setItem(CONFIG.storageKey, JSON.stringify(state.cart));
} catch (e) {}
updateUI();
};
const CartAPI = {
/**
* Add an item to the cart
* @param {string} name - Product name
* @param {number|string} price - Product price
*/
add: function(name, price) {
if (typeof name !== 'string' || name.trim().length === 0) {
console.error('Invalid product name');
return;
}
name = name.trim();
if (name.length > 200) {
console.error('Product name too long (max 200 chars)');
return;
}
price = parseFloat(price);
if (isNaN(price) || price < 0) {
console.error('Invalid price for ' + name);
return;
}
const existing = state.cart.find(item => item.name === name);
if (existing) {
existing.qty++;
} else {
state.cart.push({ name, price, qty: 1 });
}
saveState();
showToast(`Added "${name}" to cart`);
if (state.cart.length === 1 && state.cart[0].qty === 1) {
this.open();
}
},
remove: function(name) {
state.cart = state.cart.filter(item => item.name !== name);
saveState();
},
updateQty: function(name, delta) {
const item = state.cart.find(i => i.name === name);
if (!item) return;
item.qty += delta;
if (item.qty <= 0) {
this.remove(name);
} else {
saveState();
}
},
clear: function() {
state.cart = [];
saveState();
},
getCart: function() {
return [...state.cart];
},
getTotal: function() {
return state.cart.reduce((sum, item) => sum + (item.price * item.qty), 0);
},
open: function() {
state.isOpen = true;
updateUI();
},
close: function() {
state.isOpen = false;
updateUI();
},
checkout: function() {
if (state.cart.length === 0) return;
const total = this.getTotal();
const summary = [
'--- ORDER DETAILS ---',
...state.cart.map(item => `${item.qty} x ${item.name}: ${formatPrice(item.price * item.qty)}`),
'---------------------',
`TOTAL: ${formatPrice(total)}`
].join('\n');
const orderField =
document.querySelector(CONFIG.orderInputSelector) ||
document.querySelector(CONFIG.orderInputClass) ||
document.querySelector('[name="order-details"]');
if (!orderField) {
console.error('Carrd Cart: Could not find "Order Details" field (#form-shopping-cart-order-details). Please ensure it exists.');
alert('Error: Could not find the order form. Please contact support.');
return;
}
orderField.value = summary;
this.close();
window.location.href = '#shopping-cart';
}
};
window.CartPlugin = CartAPI;
window.CarrdCart = CartAPI; // Alias for backward compatibility
const ICONS = {
cart: `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="9" cy="21" r="1"></circle><circle cx="20" cy="21" r="1"></circle><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path></svg>`,
close: `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>`,
trash: `<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>`,
plus: `<svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>`,
minus: `<svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="5" y1="12" x2="19" y2="12"></line></svg>`
};
function formatPrice(amount) {
const fixed = amount.toFixed(2);
return CONFIG.currencyPosition === 'before'
? `${CONFIG.currency}${fixed}`
: `${fixed}${CONFIG.currency}`;
}
function renderCartItems() {
if (state.cart.length === 0) {
return `<div style="text-align: center; padding: 40px 0; opacity: 0.6;">${escapeHtml(CONFIG.texts.empty)}</div>`;
}
return state.cart.map(item => {
const safeName = escapeHtml(item.name);
const safeNameJs = escapeJsString(item.name);
return `
<div class="crt-item">
<div class="crt-item-info">
<span class="crt-item-name">${safeName}</span>
<span class="crt-item-price">${formatPrice(item.price)}</span>
</div>
<div class="crt-controls">
<button class="crt-btn-qty" data-action="update-qty" data-name="${safeName}" data-qty="-1" aria-label="Decrease quantity for ${safeName}">${ICONS.minus}</button>
<span>${item.qty}</span>
<button class="crt-btn-qty" data-action="update-qty" data-name="${safeName}" data-qty="1" aria-label="Increase quantity for ${safeName}">${ICONS.plus}</button>
<button class="crt-btn-qty crt-btn-remove" style="margin-left:5px" data-action="remove" data-name="${safeName}" aria-label="Remove ${safeName} from cart">${ICONS.trash}</button>
</div>
</div>
`;
}).join('');
}
function updateUI() {
const container = document.getElementById('crt-container');
if (!container) return;
const widget = container.querySelector('.crt-widget');
const badge = container.querySelector('.crt-badge');
const totalQty = state.cart.reduce((s, i) => s + i.qty, 0);
if (state.cart.length > 0) {
widget.classList.add('visible');
} else {
widget.classList.remove('visible');
}
if (badge) {
badge.textContent = totalQty;
badge.style.display = totalQty > 0 ? 'block' : 'none';
}
const overlay = container.querySelector('.crt-overlay');
const panel = container.querySelector('.crt-panel');
if (state.isOpen) {
overlay.classList.add('open');
panel.classList.add('open');
} else {
overlay.classList.remove('open');
panel.classList.remove('open');
}
const bodyContent = container.querySelector('.crt-body');
const footerContent = container.querySelector('.crt-footer');
const titleContent = container.querySelector('.crt-title');
titleContent.textContent = CONFIG.texts.title;
bodyContent.innerHTML = renderCartItems();
footerContent.style.display = 'block';
container.querySelector('.crt-total-amount').textContent = formatPrice(CartPlugin.getTotal());
const checkoutBtn = container.querySelector('.crt-btn-checkout');
if (checkoutBtn) {
checkoutBtn.disabled = state.cart.length === 0;
}
}
function createWidget() {
const div = document.createElement('div');
div.id = 'crt-container';
const posMap = {
'bottom-right': 'crt-pos-br',
'top-right': 'crt-pos-tr',
'bottom-left': 'crt-pos-bl',
'bottom-center': 'crt-pos-bc'
};
const posClass = posMap[CONFIG.position] || 'crt-pos-br';
div.innerHTML = `
<div class="crt-widget ${posClass}" data-action="open" role="button" aria-label="Open Shopping Cart" tabindex="0">
${ICONS.cart}
<div class="crt-badge" style="display:none">0</div>
</div>
<div class="crt-overlay" data-action="close"></div>
<div class="crt-panel">
<div class="crt-header">
<h2 class="crt-title">${CONFIG.texts.title}</h2>
<button class="crt-close" data-action="close" aria-label="Close Cart">${ICONS.close}</button>
</div>
<div class="crt-body"></div>
<div class="crt-footer">
<div class="crt-total-row">
<span>${CONFIG.texts.total}</span>
<span class="crt-total-amount">$0.00</span>
</div>
<button class="crt-btn-main crt-btn-checkout" data-action="checkout">${CONFIG.texts.checkout}</button>
</div>
</div>
<div class="crt-toast"></div>
`;
document.body.appendChild(div);
div.addEventListener('click', (e) => {
const trigger = e.target.closest('[data-action]');
if (!trigger) return;
const action = trigger.dataset.action;
const name = trigger.dataset.name;
if (trigger.tagName === 'BUTTON') e.preventDefault();
switch (action) {
case 'open':
CartPlugin.open();
break;
case 'close':
CartPlugin.close();
break;
case 'checkout':
CartPlugin.checkout();
break;
case 'update-qty':
const delta = parseInt(trigger.dataset.qty);
if (name && !isNaN(delta)) CartPlugin.updateQty(name, delta);
break;
case 'remove':
if (name) CartPlugin.remove(name);
break;
}
});
div.addEventListener('keydown', (e) => {
if (e.key === 'Enter' || e.key === ' ') {
const trigger = e.target.closest('[data-action="open"]');
if (trigger) {
e.preventDefault();
CartPlugin.open();
}
}
});
}
function showToast(msg) {
const toast = document.querySelector('.crt-toast');
if (!toast) return;
toast.textContent = msg;
toast.classList.add('visible');
setTimeout(() => toast.classList.remove('visible'), 3000);
}
function init() {
if (document.getElementById('crt-container')) return; // Prevent double init
createWidget();
updateUI();
}
if (document.readyState === 'loading') {
document.addEventListener('DOMContentLoaded', init);
} else {
init();
}
})();
</script>
