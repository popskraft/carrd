<style>
.FAQContainer .faq-question {
  cursor: pointer;
  position: relative;
  padding-right: 2.75rem;
  margin: 0;
  transition: color 0.2s ease;
}

.FAQContainer .faq-question:focus-visible {
  outline: 2px solid #5c9dff;
  outline-offset: 4px;
}

.FAQContainer .faq-question::after {
  content: '+';
  position: absolute;
  right: 0;
  top: 50%;
  transform: translateY(-50%);
  font-size: 1.75rem;
  line-height: 1;
  color: #5c9dff;
  transition: transform 0.3s ease;
}

.FAQContainer .faq-question.is-open::after {
  transform: translateY(-50%) rotate(45deg);
}

.FAQContainer .faq-answer {
  max-height: 0;
  overflow: hidden;
  opacity: 0;
  visibility: hidden;
  transition: max-height 0.35s ease, opacity 0.3s ease, margin 0.4s ease;
}

.FAQContainer .faq-answer.is-closed {
  margin-top: 0;
  margin-bottom: -.5rem !important;
}

.FAQContainer .faq-answer.is-open {
  opacity: 1;
  visibility: visible;
  margin-top: var(--spacing, 0.75rem);
  margin-bottom: var(--spacing, 1rem);
}

.FAQContainer .faq-answer > *:first-child {
  margin-top: 0;
}

.FAQContainer .faq-answer > *:last-child {
  margin-bottom: 0;
}

@media (prefers-reduced-motion: reduce) {
  .FAQContainer .faq-answer {
    transition: none;
  }

  .FAQContainer .faq-question::after {
    transition: none;
  }
}

</style>

<script>
(function () {
  // FAQ toggling for divider-delimited sections inside .FAQContainer elements.
  const CONTAINER_SELECTOR = '.FAQContainer';
  const DIVIDER_SELECTOR = 'hr.divider-component';
  const HEADER_TAGS = new Set(['H1', 'H2', 'H3']);
  let answerIdCounter = 0;

  const containers = document.querySelectorAll(CONTAINER_SELECTOR);
  if (!containers.length) return;

  containers.forEach(container => {
    const dividers = Array.from(container.querySelectorAll(DIVIDER_SELECTOR)).filter(
      divider => divider.closest(CONTAINER_SELECTOR) === container
    );
    if (!dividers.length) return;

    dividers.forEach(startDivider => {
      const endDivider = findNextDivider(startDivider);

      const header = findHeaderBetween(startDivider, endDivider);
      if (!header || header.dataset.faqBound === 'true') {
        return;
      }

      const answerWrapper =
        header.nextElementSibling && header.nextElementSibling.classList.contains('faq-answer')
          ? header.nextElementSibling
          : wrapAnswerContent(header, endDivider);

      if (!answerWrapper) {
        return;
      }

      prepareToggle(header, answerWrapper);
    });
  });

  window.addEventListener('resize', () => {
    document
      .querySelectorAll(`${CONTAINER_SELECTOR} .faq-answer.is-open`)
      .forEach(answer => adjustHeight(answer));
  });

  function findNextDivider(divider) {
    let node = divider.nextElementSibling;
    while (node) {
      if (isDivider(node)) {
        return node;
      }
      node = node.nextElementSibling;
    }
    return null;
  }

  function findHeaderBetween(startDivider, endDivider) {
    let node = startDivider.nextElementSibling;
    let firstParagraph = null;

    while (node && node !== endDivider) {
      if (isHeader(node)) {
        return node;
      }
      if (!firstParagraph && node.nodeType === 1 && node.tagName === 'P') {
        firstParagraph = node;
      }
      node = node.nextElementSibling;
    }

    if (!endDivider) {
      while (node) {
        if (isHeader(node)) {
          return node;
        }
        if (!firstParagraph && node.nodeType === 1 && node.tagName === 'P') {
          firstParagraph = node;
        }
        node = node.nextElementSibling;
      }
    }

    return firstParagraph;
  }

  function wrapAnswerContent(header, endDivider) {
    let node = header.nextSibling;
    const wrapper = document.createElement('div');
    wrapper.className = 'faq-answer';
    let hasContent = false;

    while (node && node !== endDivider) {
      const next = node.nextSibling;
      wrapper.appendChild(node);
      hasContent = true;
      node = next;
    }

    if (!hasContent) {
      return null;
    }

    if (endDivider && endDivider.parentNode) {
      header.parentNode.insertBefore(wrapper, endDivider);
    } else {
      header.parentNode.appendChild(wrapper);
    }
    return wrapper;
  }

  function prepareToggle(header, answer) {
    header.classList.add('faq-question');
    header.dataset.faqBound = 'true';
    header.classList.add('is-closed');
    if (!header.hasAttribute('tabindex')) {
      header.setAttribute('tabindex', '0');
    }
    header.setAttribute('role', 'button');
    header.setAttribute('aria-expanded', 'false');

    if (!answer.id) {
      answerIdCounter += 1;
      answer.id = `faq-answer-${answerIdCounter}`;
    }
    answer.setAttribute('aria-hidden', 'true');
    answer.classList.add('is-closed');

    header.setAttribute('aria-controls', answer.id);

    const toggle = () => toggleAnswer(header, answer);

    header.addEventListener('click', toggle);
    header.addEventListener('keydown', event => {
      if (event.key === 'Enter' || event.key === ' ') {
        event.preventDefault();
        toggle();
      }
    });
  }

  function toggleAnswer(header, answer) {
    const willOpen = !header.classList.contains('is-open');
    header.classList.toggle('is-open', willOpen);
    header.classList.toggle('is-closed', !willOpen);
    answer.classList.toggle('is-open', willOpen);
    answer.classList.toggle('is-closed', !willOpen);
    header.setAttribute('aria-expanded', String(willOpen));
    answer.setAttribute('aria-hidden', String(!willOpen));

    if (willOpen) {
      adjustHeight(answer);
    } else {
      answer.style.maxHeight = '0px';
    }
  }

  function adjustHeight(answer) {
    answer.style.maxHeight = `${answer.scrollHeight}px`;
  }

  function isHeader(node) {
    return node && node.nodeType === 1 && HEADER_TAGS.has(node.tagName);
  }

  function isDivider(node) {
    return (
      node &&
      node.nodeType === 1 &&
      node.tagName === 'HR' &&
      node.classList.contains('divider-component')
    );
  }
})();

</script>
