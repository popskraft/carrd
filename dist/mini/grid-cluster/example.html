<style>
.custom-grid-container {
  --grid-columns: 1;
  --grid-row-gap: 1rem;
  --grid-column-gap: 1rem;
  display: grid;
  grid-template-columns: repeat(var(--grid-columns), minmax(0, 1fr));
  row-gap: var(--grid-row-gap);
  column-gap: var(--grid-column-gap);
}

@media (max-width: 736px) {
  .custom-grid-container.grid-sm-2 {
    --grid-columns: 2;
    --grid-row-gap: 1rem;
    --grid-column-gap: 0.5rem;
  }
}

@media (min-width: 737px) {
  .custom-grid-container.grid-2,
  .custom-grid-container.grid-3,
  .custom-grid-container.grid-4,
  .custom-grid-container.grid-5,
  .custom-grid-container.grid-6 {
    --grid-columns: 2;
  }
}

@media (min-width: 1025px) {
  .custom-grid-container {
    --grid-row-gap: 2rem;
    --grid-column-gap: 1.5rem;
  }

  .custom-grid-container.grid-3,
  .custom-grid-container.grid-5,
  .custom-grid-container.grid-6 {
    --grid-columns: 3;
  }

  .custom-grid-container.grid-4 {
    --grid-columns: 4;
  }
}

@media (min-width: 1280px) {
  .custom-grid-container.grid-3,
  .custom-grid-container.grid-4 {
    --grid-column-gap: 2rem;
  }

  .custom-grid-container.grid-5 {
    --grid-columns: 5;
    --grid-column-gap: 1.5rem;
  }

  .custom-grid-container.grid-6 {
    --grid-columns: 6;
    --grid-column-gap: 1rem;
  }
}

.custom-grid-container > .container-component > .wrapper {
  width: 100% !important;
  display: flex;
  flex-direction: column;
  height: 100%;
}

.custom-grid-container > .container-component {
  overflow: hidden;
  margin: 0;
}

.custom-grid-container + .custom-grid-container {
  margin-top: var(--grid-row-gap);
}

.custom-grid-container .image-component > .frame.constrain-width {
  width: auto !important;
  max-width: 100%;
}

</style>

<script>
/**
 * Grid Cluster Script - Groups consecutive grid blocks into containers
 * Script: Finds consecutive grid elements, wraps them in custom-grid-container,
 * applies largest grid size to container, constrains wide images
 * Required classes:
 * - grid-2, grid-3, grid-4: Creates 2/3/4-column layouts
 * - grid-sm-2: Optional 2-column on small screens
 */
(function() {
  const GRID_CLASSES = ['grid-2', 'grid-3', 'grid-4', 'grid-5', 'grid-6'];
  const GRID_SELECTOR = GRID_CLASSES.map(cls => `.${cls}`).join(',');

  const isGridBlock = element =>
    element && GRID_CLASSES.some(cls => element.classList && element.classList.contains(cls));

  const getGridSize = element => {
    if (!element || !element.classList) return null;
    const sizeClass = GRID_CLASSES.find(cls => element.classList.contains(cls));
    if (!sizeClass) return null;
    const numeric = parseInt(sizeClass.split('-')[1], 10);
    return Number.isNaN(numeric) ? null : numeric;
  };

  const collected = new Set();
  const gridBlocks = document.querySelectorAll(GRID_SELECTOR);

  gridBlocks.forEach(block => {
    if (collected.has(block)) return;

    const cluster = [block];
    const baseSize = getGridSize(block);
    let sibling = block.nextElementSibling;

    while (isGridBlock(sibling)) {
      const siblingSize = getGridSize(sibling);
      if (baseSize !== null && siblingSize !== baseSize) {
        break;
      }
      cluster.push(sibling);
      collected.add(sibling);
      sibling = sibling.nextElementSibling;
    }

    collected.add(block);
    wrapCluster(cluster, baseSize);
  });

  function wrapCluster(cluster, gridSize) {
    if (!cluster.length || !cluster[0].parentNode) return;

    const container = document.createElement('div');
    const classList = ['custom-grid-container'];
    
    if (gridSize && gridSize >= 2) {
      classList.push(`grid-${gridSize}`);
    }

    if (cluster.some(el => el.classList.contains('grid-sm-2'))) {
      classList.push('grid-sm-2');
    }

    container.className = classList.join(' ');
    cluster[0].parentNode.insertBefore(container, cluster[0]);
    cluster.forEach(node => container.appendChild(node));
  }

  document.querySelectorAll('.custom-grid-container .image-component > .frame').forEach(frame => {
    const computedWidth = window.getComputedStyle(frame).width;
    const widthInRem = parseFloat(computedWidth) / parseFloat(getComputedStyle(document.documentElement).fontSize);

    if (widthInRem > 20) {
      frame.classList.add('constrain-width');
    }
  });
})();

</script>
